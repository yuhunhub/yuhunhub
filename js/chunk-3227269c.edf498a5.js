(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3227269c"],{"515d":function(e,t,n){"use strict";var r=n("b85c"),a=(n("d3b7"),n("4e82"),n("7db0"),{methods:{loadSetList:function(){var e=this;this.$yuhunset.find().sort({updatedAt:-1}).hint("updatedAt").toArray((function(t,n){e.$error(t);var a=e.$ls.get("currentSetId"),s=null;if(0<n.length){if(a){var c,i=Object(r.a)(n);try{for(i.s();!(c=i.n()).done;){var u=c.value;if(u._id+""===a){s=u;break}}}catch(t){i.e(t)}finally{i.f()}}s||(s=n[0],e.$store.commit("changeCurrentSet",s));var o=e.$store.state.currentSet;o&&o._id===s._id||e.$store.commit("changeCurrentSet",s),e.$ls.set("currentSetId",s._id)}e.$store.commit("setupSetList",n)}))}}});n=n("2877"),n=Object(n.a)(a,void 0,void 0,!1,null,null,null);t.a=n.exports},"91a2":function(e,t,n){"use strict";var r=n("1da1"),a=(n("96cf"),n("3ca3"),n("ddb0"),n("e2a9")),s=n("f279"),c=n("9d39"),i=n("515d");s={mixins:[s.a,c.a,i.a],data:function(){return{syncNotify:null,syncMessage:null,isSyncing:!1,isNeedSyncAgain:!1}},methods:{checkAndSync:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var s,c,i,u,o,d,f,l,y,p,x,b,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.isSyncing)return t.isNeedSyncAgain=!0,n.abrupt("return");n.next=3;break;case 3:return n.prev=3,t.isSyncing=!0,n.next=7,a.a.brief();case 7:return c=n.sent,c=c.data,s=c,n.next=12,t.$historyFind();case 12:return c=n.sent,n.next=15,t.checkAndSyncOne("history","history",null,s,c,c.updatedAt);case 15:if(i=n.sent,u=i.newValue)return n.next=20,t.$historyFind();n.next=30;break;case 20:if(o=n.sent,o=o.updatedAt,d=new Date(s.updatedAt.history),!o||d.getTime()>o.getTime())return t.$store.commit("setupHistory",u),n.next=27,t.$historySave(u,d);n.next=29;break;case 27:n.next=30;break;case 29:t.isNeedSyncAgain=!0;case 30:return n.next=32,t.$myPresetFind();case 32:return o=n.sent,n.next=35,t.checkAndSyncOne("myPreset","myPreset",null,s,o,o.updatedAt);case 35:if(i=n.sent,u=i.newValue)return n.next=40,t.$myPresetFind();n.next=50;break;case 40:if(d=n.sent,f=d.updatedAt,l=new Date(s.updatedAt.myPreset),!f||l.getTime()>f.getTime())return t.$store.commit("setupMyPreset",u),n.next=47,t.$myPresetSave(u,l);n.next=49;break;case 47:n.next=50;break;case 49:t.isNeedSyncAgain=!0;case 50:return n.next=52,t.$favHeroFind();case 52:return f=n.sent,n.next=55,t.checkAndSyncOne("favHero","favHero",null,s,f,f.updatedAt);case 55:if(i=n.sent,u=i.newValue)return n.next=60,t.$favHeroFind();n.next=70;break;case 60:if(l=n.sent,y=l.updatedAt,p=new Date(s.updatedAt.favHero),!y||p.getTime()>y.getTime())return t.$store.commit("setupFavHero",u),n.next=67,t.$favHeroSave(u,p);n.next=69;break;case 67:n.next=70;break;case 69:t.isNeedSyncAgain=!0;case 70:if(!(0<(x=s.syncAccount))){n.next=82;break}b=regeneratorRuntime.mark((function e(n){var a,c,o,d,f,l,y,p,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s["set".concat(n,"Id")]){e.next=3;break}return e.abrupt("return","continue");case 3:return e.next=5,t.$setFindById(a);case 5:return c=e.sent,o=c&&c.updatedAt,e.next=9,t.checkAndSyncOne("set".concat(n),"set".concat(n,"set"),"set",s,c,c&&c.setUpdatedAt);case 9:if(i=e.sent,u=i.newValue)return e.next=14,t.$setFindById(a);e.next=30;break;case 14:if(c=e.sent,d=new Date(s.updatedAt["set".concat(n,"set")]),c&&c.setUpdatedAt&&!(d.getTime()>c.setUpdatedAt.getTime())){e.next=28;break}if(c)return e.next=20,t.$yuhunset.update({_id:{$eq:a}},u);e.next=22;break;case 20:e.next=24;break;case 22:return e.next=24,t.$yuhunset.insert(u);case 24:return e.next=26,t.$yuhunset.update({_id:{$eq:a}},{setUpdatedAt:d});case 26:e.next=29;break;case 28:t.isNeedSyncAgain=!0;case 29:t.currentSet&&t.currentSet._id===a&&t.$store.commit("changeCurrentSet",u);case 30:return x=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$yuhunFindBySetId(a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=33,t.checkAndSyncOne("set".concat(n),"set".concat(n,"yuhun"),"yuhun",s,x,c&&c.updatedAt);case 33:if(i=e.sent,!(u=i.newValue)){e.next=45;break}if(f=new Date(s.updatedAt["set".concat(n,"yuhun")]),!o||f.getTime()>new Date(o).getTime())return e.next=40,t.saveYuhunAsync(a,u);e.next=44;break;case 40:return e.next=42,t.$yuhunset.update({_id:{$eq:a}},{updatedAt:f});case 42:e.next=45;break;case 44:t.isNeedSyncAgain=!0;case 45:return e.next=47,t.$collectionFindBySetId(a);case 47:return l=e.sent,e.next=50,t.checkAndSyncOne("set".concat(n),"set".concat(n,"collection"),"collection",s,l,l&&l.updatedAt);case 50:if(i=e.sent,u=i.newValue)return e.next=55,t.$collectionFindBySetId(a);e.next=66;break;case 55:if(l=e.sent,y=new Date(s.updatedAt["set".concat(n,"collection")]),l&&l.updatedAt&&!(y.getTime()>new Date(l.updatedAt).getTime())){e.next=66;break}if(l)return e.next=61,t.$collection.update({setId:{$eq:a}},{list:u,updatedAt:y});e.next=63;break;case 61:e.next=65;break;case 63:return e.next=65,t.$collection.insert({setId:a,list:u,updatedAt:y});case 65:t.currentSet&&t.currentSet._id===a&&t.$store.commit("setCurrentCollections",u);case 66:return e.next=68,t.$trashRulesFindBySetId(a);case 68:return p=e.sent,e.next=71,t.checkAndSyncOne("set".concat(n),"set".concat(n,"trashRules"),"trashRules",s,p,p&&p.updatedAt);case 71:if(i=e.sent,u=i.newValue)return e.next=76,t.$trashRulesFindBySetId(a);e.next=86;break;case 76:if(p=e.sent,x=new Date(s.updatedAt["set".concat(n,"trashRules")]),p&&p.updatedAt&&!(x.getTime()>new Date(p.updatedAt).getTime())){e.next=86;break}if(p)return e.next=82,t.$trashRules.update({setId:{$eq:a}},u);e.next=84;break;case 82:e.next=86;break;case 84:return e.next=86,t.$trashRules.insert(u);case 86:case"end":return e.stop()}}),e)})),h=1;case 74:if(h<=x)return n.delegateYield(b(h),"t0",76);n.next=82;break;case 76:if("continue"===n.t0)return n.abrupt("continue",79);n.next=79;break;case 79:h++,n.next=74;break;case 82:t.$store.commit("setCurrentSyncBrief",s),t.closeNotify((function(){t.$notify({title:"同步",message:"同步成功！",type:"success",position:"bottom-right",offset:100})}),(function(){e||t.$notify({title:"同步",message:"无需同步，已经是最新数据！",type:"success",position:"bottom-right",offset:100})})),t.isSyncing=!1,t.loadSetList(),t.isNeedSyncAgain&&(t.isNeedSyncAgain=!1,t.checkAndSync()),n.next=95;break;case 89:n.prev=89,n.t1=n.catch(3),t.closeNotify(),t.$notify({title:"同步",message:"同步出错！请检查网络并重试。",type:"error",position:"bottom-right",offset:100}),console.error(n.t1),t.isSyncing=!1;case 95:case"end":return n.stop()}}),n,null,[[3,89]])})))()},checkAndSyncOne:function(e,t,n,s,c,i){var u=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var o,d,f,l,y;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=i,d=s.updatedAt&&s.updatedAt[t],!o&&d||o&&d&&new Date(o).getTime()<new Date(d).getTime())return f={syncName:e,subSyncName:n},u.showNotify(e,n),r.next=7,a.a.download(f);r.next=10;break;case 7:return f=r.sent,y=f.data,r.abrupt("return",{newValue:y});case 10:if(!(o&&!d||!o&&!d||o&&d&&new Date(o).getTime()>new Date(d).getTime())){r.next=25;break}if(l=c){r.next=14;break}return r.abrupt("return",{});case 14:if("function"==typeof c)return r.next=17,c();r.next=18;break;case 17:l=r.sent;case 18:return y={},n?(y[e]={},y[e][n]=l):y[e]=l,y.updatedAt=o||new Date,u.showNotify(e,n),r.next=24,a.a.upload(y);case 24:case 25:return r.abrupt("return",{});case 26:case"end":return r.stop()}}),r)})))()},saveYuhunAsync:function(e,t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.$yuhunRemoveAll(e);case 2:return r.next=4,n.$yuhunSave(e,t);case 4:case"end":return r.stop()}}),r)})))()},closeNotify:function(e,t){this.syncNotify?(this.syncNotify.close(),this.syncNotify=null,e&&e()):t&&t()},showNotify:function(e,t){this.syncNotify||(this.syncNotify=this.$notify({title:"同步",type:"info",message:"数据云同步中，请稍候……",position:"bottom-right",showClose:!1,offset:100,duration:0}))}}},c=n("2877"),i=Object(c.a)(s,void 0,void 0,!1,null,null,null);t.a=i.exports},"99af":function(e,t,n){"use strict";var r=n("23e7"),a=n("da84"),s=n("d039"),c=n("e8b5"),i=n("861d"),u=n("7b0b"),o=n("07fa"),d=n("8418"),f=n("65f0"),l=n("1dde"),y=n("b622"),p=(n=n("2d00"),y("isConcatSpreadable")),x=9007199254740991,b="Maximum allowed index exceeded",h=a.TypeError;y=51<=n||!s((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),a=l("concat");r({target:"Array",proto:!0,forced:!y||!a},{concat:function(e){for(var t,n,r,a=u(this),s=f(a,0),l=0,y=-1,m=arguments.length;y<m;y++)if(function(e){if(!i(e))return!1;var t=e[p];return void 0!==t?!!t:c(e)}(r=-1===y?a:arguments[y])){if(n=o(r),x<l+n)throw h(b);for(t=0;t<n;t++,l++)t in r&&d(s,l,r[t])}else{if(x<=l)throw h(b);d(s,l++,r)}return s.length=l,s}})},"9d39":function(e,t,n){"use strict";var r=n("2f62");r={computed:Object(r.b)({currentSet:function(e){return e.currentSet}})},n=n("2877"),n=Object(n.a)(r,void 0,void 0,!1,null,null,null);t.a=n.exports},e2a9:function(e,t,n){"use strict";var r=n("5765"),a=(r=n.n(r),n("8bbf"));n=n.n(a),a={brief:{method:"GET",url:r.a.baseUrl+"api/sync/brief"},setBrief:{method:"POST",url:r.a.baseUrl+"api/sync/brief"},upload:{method:"POST",url:r.a.baseUrl+"api/sync/upload"},download:{method:"GET",url:r.a.baseUrl+"api/sync/download"},cancel:{method:"POST",url:r.a.baseUrl+"api/sync/cancel"}};t.a=n.a.resource(r.a.baseUrl+"api/sync",{},a)},f279:function(e,t,n){"use strict";var r=n("2f62");r={computed:Object(r.b)({currentSyncBrief:function(e){return e.currentSyncBrief}})},n=n("2877"),n=Object(n.a)(r,void 0,void 0,!1,null,null,null);t.a=n.exports}}]);